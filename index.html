<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chorderline</title>
  <style>
    body {
      background-color: #f0f0f0;
      color: #000;
      font-family: sans-serif;
      padding: 20px;
      transition: background-color 0.5s, color 0.5s;
    }
    .darkmode {
      background-color: #121212;
      color: #fff;
    }
    .section-box {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.5s, color 0.5s;
    }
    .darkmode .section-box {
      background: #1e1e1e;
      color: #fff;
      box-shadow: none;
    }
    nav.navbar {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 20px;
    }
    nav.navbar button {
      background: none;
      border: 1px solid currentColor;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
      color: inherit;
      transition: background-color 0.3s;
    }
    nav.navbar button:hover {
      background-color: #ddd;
    }
    .darkmode nav.navbar button:hover {
      background-color: #333;
    }

    /* ========== CHORD LIST ========== */
    #chordList {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 16px;
      padding-top: 10px;
    }
    #chordList label {
      position: relative;
      padding-right: 30px;
      display: flex;
      align-items: center;
    }
    #chordList label button {
      position: absolute;
      right: 4px;
      background: transparent;
      border: none;
      color: red;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.2em;
      user-select: none;
    }

    /* ======= PREVIEW BUTTON GLOW UP ======= */
    button.fancy-button {
      background-color: #6200ea;
      color: white;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      box-shadow: 0 0 10px #6200ea;
      transition: box-shadow 0.3s ease-in-out, transform 0.15s ease;
    }
    button.fancy-button:hover {
      box-shadow: 0 0 20px #9a4dff, 0 0 30px #bb7fff;
      transform: scale(1.05);
    }

    .toggle-darkmode {
      margin-left: auto;
      font-weight: bold;
    }
    input[type="text"], select, input[type="number"] {
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 5px;
      font-size: 1em;
      margin-left: 8px;
    }
    input[type="number"] {
      width: 80px;
    }
    label {
      font-weight: 600;
    }

    /* Rhythm grid styling */
    #rhythmGrid {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      gap: 6px;
      margin-top: 10px;
      user-select: none;
    }
    .beat-box {
      width: 40px;
      height: 40px;
      border: 2px solid #888;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .beat-box.active {
      background-color: #4caf50;
      border-color: #388e3c;
      color: white;
    }
    .darkmode .beat-box {
      border-color: #aaa;
    }
    .darkmode .beat-box.active {
      background-color: #81c784;
      border-color: #4caf50;
    }

    /* ======= DEV MODE BOX ======= */
    #devModeBox {
      background: #222;
      color: #0f0;
      font-family: monospace;
      white-space: pre-wrap;
      margin-top: 20px;
      padding: 10px;
      border-radius: 8px;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }
  </style>
</head>
<body>

  <h1>üé∏ Chorderline</h1>

  <!-- Navigation -->
  <nav class="navbar section-box">
    <button onclick="showPage('info')">Info</button>
    <button onclick="showPage('setup')">Setup</button>
    <button onclick="showPage('chord')">Chord</button>
    <button onclick="showPage('rhythm')">Rhythm</button>
    <button onclick="showPage('preview')">Preview</button>
    <button class="toggle-darkmode" onclick="toggleDarkMode()">Toggle Darkmode</button>
  </nav>

  <!-- Pages -->
  <div id="info" class="page section-box active">
    <h2>Welcome to Chorderline</h2>
    <p>This is a random post-punk chord & rhythm generator. Move through each tab to configure your generation. ‚ÄúSetup‚Äù handles basic key info, ‚ÄúChord‚Äù handles progressions, and so on. Simple as that.</p>
  </div>

  <div id="setup" class="page section-box" style="display:none;">
    <h2>Setup</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
      <div>
        <label for="key">Key:</label>
        <select id="key">
          <option value="C major">C major</option>
          <option value="C# major">C# major / Db major</option>
          <option value="D major">D major</option>
          <option value="D# major">D# major / Eb major</option>
          <option value="E major">E major</option>
          <option value="F major">F major</option>
          <option value="F# major">F# major / Gb major</option>
          <option value="G major">G major</option>
          <option value="G# major">G# major / Ab major</option>
          <option value="A major">A major</option>
          <option value="A# major">A# major / Bb major</option>
          <option value="B major">B major</option>
          <option value="C minor">C minor</option>
          <option value="C# minor">C# minor / Db minor</option>
          <option value="D minor">D minor</option>
          <option value="D# minor">D# minor / Eb minor</option>
          <option value="E minor">E minor</option>
          <option value="F minor">F minor</option>
          <option value="F# minor">F# minor / Gb minor</option>
          <option value="G minor">G minor</option>
          <option value="G# minor">G# minor / Ab minor</option>
          <option value="A minor">A minor</option>
          <option value="A# minor">A# minor / Bb minor</option>
          <option value="B minor">B minor</option>
        </select>
      </div>
      <div>
        <label for="tempo">Tempo (BPM):</label>
        <input type="number" id="tempo" min="40" max="240" value="120" />
      </div>
      <div>
        <label for="timesig">Time Signature:</label>
        <select id="timesig">
          <option value="4/4">4/4</option>
          <option value="3/4">3/4</option>
          <option value="6/8">6/8</option>
          <option value="7/8">7/8</option>
        </select>
      </div>
    </div>
  </div>

  <div id="chord" class="page section-box" style="display:none;">
    <h2>Chord Progressions</h2>
    <p>
      Select one or more progressions below. Chorderline will pick one at random when generating.
      These are written using Roman numerals for flexibility across keys and modes.
      You can only select progressions matching the key type (major or minor). Others are disabled and greyed out.
    </p>

    <div id="progressionList"></div>

    <button class="fancy-button" onclick="generateChordProgression()">Generate Progression</button>

    <h3>Generated Chords</h3>
    <div id="generatedChords" style="margin-top:10px; font-family: monospace;"></div>
  </div>

  <div id="rhythm" class="page section-box" style="display:none;">
    <h2>Rhythm</h2>
    <p>Click the squares below to toggle drum hits.</p>
    <div id="rhythmGrid"></div>
  </div>

  <div id="preview" class="page section-box" style="display:none;">
    <h2>Preview</h2>
    <p>Currently, no audio playback but here‚Äôs where you‚Äôd preview your creation.</p>
  </div>

  <div id="devModeBox"></div>

  <script>
    // Page navigation
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(p => p.style.display = 'none');
      const page = document.getElementById(pageId);
      if (page) page.style.display = 'block';
    }

    // Dark mode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('darkmode');
    }

    // === Progressions & Keys ===

    const progressions = [
      { name: 'I - IV - V', chords: ['I', 'IV', 'V'], type: 'major' },
      { name: 'vi - IV - I - V', chords: ['vi', 'IV', 'I', 'V'], type: 'major' },
      { name: 'I - V - vi - IV', chords: ['I', 'V', 'vi', 'IV'], type: 'major' },
      { name: 'i - iv - v', chords: ['i', 'iv', 'v'], type: 'minor' },
      { name: 'i - VI - III - VII', chords: ['i', 'VI', 'III', 'VII'], type: 'minor' },
      { name: 'i - VII - VI - VII', chords: ['i', 'VII', 'VI', 'VII'], type: 'minor' },
      { name: '‚ô≠II - ‚ô≠VII', chords: ['‚ô≠II', '‚ô≠VII'], type: 'dissonant' }, // locked out
    ];

    // Get key type (major or minor) from selected key string
    function getKeyType(key) {
      if (!key) return null;
      return key.toLowerCase().includes('minor') ? 'minor' : 'major';
    }

    // Show progressions filtered by key type; disable the wrong ones
    function renderProgressions() {
      const key = document.getElementById('key').value;
      const keyType = getKeyType(key);
      const container = document.getElementById('progressionList');
      container.innerHTML = '';

      progressions.forEach((prog, i) => {
        const isDisabled = prog.type !== keyType;

        const label = document.createElement('label');
        label.style.opacity = isDisabled ? 0.4 : 1;
        label.style.pointerEvents = isDisabled ? 'none' : 'auto';

        const checkbox = document.createElement('input');
        checkbox.type = 'checkbox';
        checkbox.disabled = isDisabled;
        checkbox.name = 'progression';
        checkbox.value = i;

        label.appendChild(checkbox);
        label.appendChild(document.createTextNode(' ' + prog.name + ' (' + prog.type + ')'));

        container.appendChild(label);
        container.appendChild(document.createElement('br'));
      });
    }

    // Map roman numeral chords to chords for major and minor keys (simplified)
    // This is a barebones example. You can expand with actual pitch calculations later.
    function getChordFromRoman(roman, keyType, keyRoot) {
      // For simplicity, chord qualities (not pitches)
      const qualitiesMajor = {
        I: 'maj', ii: 'min', iii: 'min', IV: 'maj', V: 'maj', vi: 'min', 'vii¬∞': 'dim',
      };
      const qualitiesMinor = {
        i: 'min', ii: 'dim', III: 'maj', iv: 'min', v: 'min', VI: 'maj', VII: 'maj',
      };

      // Just return a string for now
      let quality = '';
      if (keyType === 'major') {
        quality = qualitiesMajor[roman] || 'maj?';
      } else if (keyType === 'minor') {
        quality = qualitiesMinor[roman] || 'min?';
      } else {
        quality = '???';
      }
      return `${keyRoot} ${roman} (${quality})`;
    }

    // When user clicks Generate, pick a progression from the selected ones and show chords
    function generateChordProgression() {
      const key = document.getElementById('key').value;
      const keyType = getKeyType(key);
      const keyRoot = key.split(' ')[0];

      const checkboxes = Array.from(document.querySelectorAll('input[name="progression"]:checked'));
      if (checkboxes.length === 0) {
        alert('Please select at least one chord progression that matches the key type!');
        return;
      }

      // Pick one randomly
      const chosenIndex = +checkboxes[Math.floor(Math.random() * checkboxes.length)].value;
      const progression = progressions[chosenIndex];

      // Map chords to their representation
      const chordsOutput = progression.chords.map(rn => getChordFromRoman(rn, keyType, keyRoot));

      // Show in UI
      const container = document.getElementById('generatedChords');
      container.textContent = chordsOutput.join(' - ');
    }

    // Initial render
    renderProgressions();

    // Update progressions when key changes
    document.getElementById('key').addEventListener('change', () => {
      renderProgressions();
      // Clear generated chords
      document.getElementById('generatedChords').textContent = '';
    });

  </script>

</body>
</html>
