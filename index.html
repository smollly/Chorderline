<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chorderline</title>
  <style>
    body {
      background-color: #f0f0f0;
      color: #000;
      font-family: sans-serif;
      padding: 20px;
      transition: background-color 0.5s, color 0.5s;
    }
    .darkmode {
      background-color: #121212;
      color: #fff;
    }
    .section-box {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: background-color 0.5s, color 0.5s;
    }
    .darkmode .section-box {
      background: #1e1e1e;
      color: #fff;
      box-shadow: none;
    }
    nav.navbar {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 20px;
    }
    nav.navbar button {
      background: none;
      border: 1px solid currentColor;
      border-radius: 6px;
      padding: 6px 12px;
      font-weight: bold;
      cursor: pointer;
      color: inherit;
      transition: background-color 0.3s;
    }
    nav.navbar button:hover {
      background-color: #ddd;
    }
    .darkmode nav.navbar button:hover {
      background-color: #333;
    }
    #chordList {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 16px;
      padding-top: 10px;
    }
    .custom-prog-entry {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .custom-prog-entry button {
      background: transparent;
      border: none;
      color: red;
      cursor: pointer;
      font-size: 1em;
    }
    .toggle-darkmode {
      margin-left: auto;
      font-weight: bold;
    }
    input[type="text"], select, input[type="number"] {
      border-radius: 4px;
      border: 1px solid #ccc;
      padding: 5px;
      font-size: 1em;
      margin-left: 8px;
    }
    input[type="number"] {
      width: 80px;
    }
    label {
      font-weight: 600;
    }
    /* Rhythm grid styling */
    #rhythmGrid {
      display: grid;
      grid-template-columns: repeat(8, 40px);
      gap: 6px;
      margin-top: 10px;
      user-select: none;
    }
    .beat-box {
      width: 40px;
      height: 40px;
      border: 2px solid #888;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      transition: background-color 0.3s, border-color 0.3s;
    }
    .beat-box.active {
      background-color: #4caf50;
      border-color: #388e3c;
      color: white;
    }
    .darkmode .beat-box {
      border-color: #aaa;
    }
    .darkmode .beat-box.active {
      background-color: #81c784;
      border-color: #4caf50;
    }
  </style>
</head>
<body>

  <h1>üé∏ Chorderline</h1>

  <!-- Navigation -->
  <nav class="navbar section-box">
    <button onclick="showPage('info')">Info</button>
    <button onclick="showPage('setup')">Setup</button>
    <button onclick="showPage('chord')">Chord</button>
    <button onclick="showPage('rhythm')">Rhythm</button>
    <button onclick="showPage('preview')">Preview</button>
    <button class="toggle-darkmode" onclick="toggleDarkMode()">Toggle Darkmode</button>
  </nav>

  <!-- Pages -->
  <div id="info" class="page section-box active">
    <h2>Welcome to Chorderline</h2>
    <p>This is a random post-punk chord & rhythm generator. Move through each tab to configure your generation. ‚ÄúSetup‚Äù handles basic key info, ‚ÄúChord‚Äù handles progressions, and so on. Simple as that.</p>
  </div>

  <div id="setup" class="page section-box" style="display:none;">
    <h2>Setup</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
      <div>
        <label for="key">Key:</label>
        <select id="key">
          <option value="C">C</option>
          <option value="C#">C# / Db</option>
          <option value="D">D</option>
          <option value="D#">D# / Eb</option>
          <option value="E">E</option>
          <option value="F">F</option>
          <option value="F#">F# / Gb</option>
          <option value="G">G</option>
          <option value="G#">G# / Ab</option>
          <option value="A">A</option>
          <option value="A#">A# / Bb</option>
          <option value="B">B</option>
        </select>
      </div>
      <div>
        <label for="tempo">Tempo (BPM):</label>
        <input type="number" id="tempo" min="40" max="240" value="120" />
      </div>
      <div>
        <label for="timesig">Time Signature:</label>
        <select id="timesig">
          <option value="4/4">4/4</option>
          <option value="3/4">3/4</option>
          <option value="6/8">6/8</option>
          <option value="7/8">7/8</option>
        </select>
      </div>
    </div>
  </div>

  <div id="chord" class="page section-box" style="display:none;">
    <h2>Chord Progressions</h2>
    <p>
      Select one or more progressions below. Chorderline will pick one at random when generating.
      These are written using Roman numerals for flexibility across keys and modes.
      You can also enter your own progression if you don‚Äôt see one you like.
    </p>
    <div style="margin-bottom: 10px;">
      <button onclick="toggleCheckboxes(true)">Apply All</button>
      <button onclick="toggleCheckboxes(false)">Disable All</button>
    </div>
    <div id="chordList">
      <label><input type="checkbox" value="I - V - IV" /> I - V - IV</label>
      <label><input type="checkbox" value="I - V - vi - IV" /> I - V - vi - IV</label>
      <label><input type="checkbox" value="V - vi - IV" /> V - vi - IV</label>
      <label><input type="checkbox" value="i - VI - III - V" /> i - VI - III - V</label>
      <label><input type="checkbox" value="I - V - vi - IV - ii - V" /> I - V - vi - IV - ii - V</label>
      <label><input type="checkbox" value="I - V - vi - IV - I" /> I - V - vi - IV - I</label>
      <label><input type="checkbox" value="I - iii - ii - V" /> I - iii - ii - V</label>
      <label><input type="checkbox" value="i - VII - III - v" /> i - VII - III - v</label>
      <label><input type="checkbox" value="vi - I - V - IV" /> vi - I - V - IV</label>
      <label><input type="checkbox" value="i - VI - v - VII" /> i - VI - v - VII</label>
      <label><input type="checkbox" value="I - V - IV - V - vi" /> I - V - IV - V - vi</label>
      <label><input type="checkbox" value="i - VI - iv - VII" /> i - VI - iv - VII</label>
      <label><input type="checkbox" value="I - vi - iii - IV" /> I - vi - iii - IV</label>
      <label><input type="checkbox" value="vi - ‚ô≠VII - V - I" /> vi - ‚ô≠VII - V - I</label>
      <label><input type="checkbox" value="I - II - IV - V" /> I - II - IV - V</label>
      <label><input type="checkbox" value="I - IV - vi - IV" /> I - IV - vi - IV</label>
      <label><input type="checkbox" value="i - III - vi - V" /> i - III - vi - V</label>
      <label><input type="checkbox" value="VI - III - VII - i" /> VI - III - VII - i</label>
      <label><input type="checkbox" value="I - V - vi - II" /> I - V - vi - II</label>
      <label><input type="checkbox" value="vi - I - IV - iii" /> vi - I - IV - iii</label>
      <label><input type="checkbox" value="I - vi - IV" /> I - vi - IV</label>
    </div>
    <div style="margin-top: 15px;">
      <input type="text" id="customProg" placeholder="Add your own progression e.g. i - iv - v" style="width: 60%" />
      <button onclick="addCustomProg()">Add</button>
      <p style="font-size: 0.9em; color: #666; margin-top: 8px;">
        <strong>Note:</strong> Use only <em>all uppercase</em> (major) or <em>all lowercase</em> (minor) Roman numerals per chord, with optional flats (‚ô≠ or b) and extensions. Mixing upper and lower in the same chord (e.g., vI) is not allowed.
      </p>
    </div>
  </div>

  <div id="rhythm" class="page section-box" style="display:none;">
    <h2>Rhythm</h2>
    <p>Click the beats below to toggle where chords will play.</p>
    <div id="rhythmGrid"></div>
  </div>

  <div id="preview" class="page section-box" style="display:none;">
    <h2>Preview</h2>
    <button onclick="generateChordProg()">Generate Progression</button>
    <p id="previewResult" style="font-size: 1.3em; margin-top: 20px;"></p>
  </div>

  <script>
    // Page show/hide logic
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => {
        p.style.display = (p.id === id) ? 'block' : 'none';
      });
    }

    // Darkmode toggle
    function toggleDarkMode() {
      document.body.classList.toggle('darkmode');
    }

    // Apply or Disable all chord checkboxes
    function toggleCheckboxes(state) {
      document.querySelectorAll('#chordList input[type="checkbox"]').forEach(cb => {
        cb.checked = state;
      });
    }

    // Add custom progression to list if valid
    function addCustomProg() {
      const input = document.getElementById('customProg');
      const prog = input.value.trim();
      if (!prog) return alert("You gotta type something first!");

      if (!validateRomanNumeralProg(prog)) {
        return alert("Invalid chord progression! Remember: chords must be all uppercase or all lowercase Roman numerals per chord (no mixing), optional flats (‚ô≠ or b), and optional extensions. Separate chords with '-' or '‚Äì' or '‚Äî'.");
      }

      // Check if already exists
      const existing = [...document.querySelectorAll('#chordList input[type="checkbox"]')]
        .some(cb => cb.value.toLowerCase() === prog.toLowerCase());
      if (existing) {
        return alert("That progression's already here!");
      }

      // Create new checkbox
      const label = document.createElement('label');
      const cb = document.createElement('input');
      cb.type = 'checkbox';
      cb.value = prog;
      cb.checked = true;

      // Add a remove button for the custom progression
      const removeBtn = document.createElement('button');
      removeBtn.textContent = "‚úñ";
      removeBtn.title = "Remove this progression";
      removeBtn.onclick = (e) => {
        e.preventDefault();
        label.remove();
      };

      label.appendChild(cb);
      label.appendChild(document.createTextNode(" " + prog + " "));
      label.appendChild(removeBtn);

      document.getElementById('chordList').appendChild(label);
      input.value = '';
    }

    // Validate Roman numeral progression
    // Must have at least 2 chords separated by dash (-) or dash variants
    // Each chord must be all uppercase OR all lowercase Roman numerals, optional flat (‚ô≠ or b), optional extensions (e.g. 7, sus2, add9)
    // No mixing of uppercase and lowercase letters in the same chord allowed
    function validateRomanNumeralProg(prog) {
      if (!prog || !prog.trim()) return false;
      let chords = prog.split(/\s*[-‚Äì‚Äî]\s*/);
      if (chords.length < 2) return false;

      // Regex:
      // ^ start and $ end anchors for full chord match
      // ([IV]+|[iv]+) = either all uppercase Roman numerals or all lowercase Roman numerals
      // (‚ô≠|b)? optional flat symbol after numerals
      // (\(?((sus|add)?[0-9]+)?\)?)? optional extensions like (sus2), add9, 7, etc, with or without parentheses
      const chordRegex = /^([IV]+|[iv]+)(‚ô≠|b)?(\(?((sus|add)?[0-9]+)?\)?)?$/;

      for (let ch of chords) {
        ch = ch.trim();
        if (!chordRegex.test(ch)) return false;
      }
      return true;
    }

    // Generate chord progression from checked checkboxes
    function generateChordProg() {
      const checked = [...document.querySelectorAll('#chordList input[type="checkbox"]:checked')];
      if (!checked.length) return alert("Pick at least one progression first!");

      // Pick random progression
      const prog = checked[Math.floor(Math.random() * checked.length)].value;
      document.getElementById('previewResult').textContent = prog;
    }

    // Rhythm grid toggling
    const rhythmGrid = document.getElementById('rhythmGrid');
    const beatsCount = 8;
    let beatStates = Array(beatsCount).fill(false);

    for (let i = 0; i < beatsCount; i++) {
      let box = document.createElement('div');
      box.className = 'beat-box';
      box.textContent = i + 1;
      box.onclick = () => {
        beatStates[i] = !beatStates[i];
        box.classList.toggle('active');
      };
      rhythmGrid.appendChild(box);
    }
  </script>
</body>
</html>
