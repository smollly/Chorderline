<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chorderline</title>
  <style>
    body {
      font-family: sans-serif;
      background-color: #f0f0f0;
      color: #000;
      padding: 20px;
      transition: background-color 0.3s, color 0.3s;
    }
    .dark-mode {
      background-color: #1e1e1e;
      color: white;
    }
    .section-box {
      background: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
      transition: background 0.3s;
    }
    .dark-mode .section-box {
      background: #2c2c2c;
    }
    .navbar button, .dark-toggle button {
      margin-right: 10px;
      padding: 6px 12px;
      border-radius: 6px;
      border: none;
      cursor: pointer;
    }
    .dark-toggle {
      position: absolute;
      top: 20px;
      right: 20px;
    }
    #chordList {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px 16px;
      padding-top: 10px;
    }
    .custom-prog-entry {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .custom-prog-entry button {
      background: transparent;
      border: none;
      color: red;
      cursor: pointer;
      font-size: 1em;
    }
  </style>
</head>
<body>

  <h1>üé∏ Chorderline</h1>

  <div class="dark-toggle">
    <button onclick="toggleDarkMode()">Toggle Darkmode</button>
  </div>

  <nav class="navbar section-box">
    <button onclick="showPage('info')">Info</button>
    <button onclick="showPage('setup')">Setup</button>
    <button onclick="showPage('chord')">Chord</button>
    <button onclick="showPage('rhythm')">Rhythm</button>
    <button onclick="showPage('preview')">Preview</button>
  </nav>

  <div id="info" class="page section-box active">
    <h2>Welcome to Chorderline</h2>
    <p>This is a random post-punk chord & rhythm generator. Move through each tab to configure your generation. ‚ÄúSetup‚Äù handles basic key info, ‚ÄúChord‚Äù handles progressions, and so on. Simple as that.</p>
  </div>

  <div id="setup" class="page section-box" style="display:none;">
    <h2>Setup</h2>
    <div style="display: flex; flex-wrap: wrap; gap: 20px;">
      <div>
        <label for="key">Key:</label>
        <select id="key">
          <option value="C">C</option>
          <option value="C#">C#</option>
          <option value="D">D</option>
          <option value="D#">D#</option>
          <option value="E">E</option>
          <option value="F">F</option>
          <option value="F#">F#</option>
          <option value="G">G</option>
          <option value="G#">G#</option>
          <option value="A">A</option>
          <option value="A#">A#</option>
          <option value="B">B</option>
        </select>
      </div>
      <div>
        <label for="mode">Mode:</label>
        <select id="mode">
          <option value="major">Major</option>
          <option value="minor">Minor</option>
        </select>
      </div>
      <div>
        <label for="tempo">Tempo (BPM):</label>
        <input type="number" id="tempo" min="40" max="240" value="120" />
      </div>
      <div>
        <label for="timesig">Time Signature:</label>
        <select id="timesig">
          <option value="4/4">4/4</option>
          <option value="3/4">3/4</option>
          <option value="6/8">6/8</option>
        </select>
      </div>
    </div>
  </div>

  <div id="chord" class="page section-box" style="display:none;">
    <h2>Chord Progressions</h2>
    <p>Select one or more progressions. A random one will be chosen for generation. You can also add your own!</p>
    <div style="margin-bottom: 10px;">
      <button onclick="toggleCheckboxes(true)">Apply All</button>
      <button onclick="toggleCheckboxes(false)">Disable All</button>
    </div>
    <div id="chordList">
      <label><input type="checkbox" value="I - V - IV" /> I - V - IV</label>
      <label><input type="checkbox" value="I - V - vi - IV" /> I - V - vi - IV</label>
      <label><input type="checkbox" value="V - vi - IV" /> V - vi - IV</label>
      <label><input type="checkbox" value="i - VI - III - V" /> i - VI - III - V</label>
      <label><input type="checkbox" value="I - V - vi - IV - ii - V" /> I - V - vi - IV - ii - V</label>
      <label><input type="checkbox" value="I - V - vi - IV - I" /> I - V - vi - IV - I</label>
      <label><input type="checkbox" value="I - iii - ii - V" /> I - iii - ii - V</label>
      <label><input type="checkbox" value="i - VII - III - v" /> i - VII - III - v</label>
      <label><input type="checkbox" value="vi - I - V - IV" /> vi - I - V - IV</label>
      <label><input type="checkbox" value="i - VI - v - VII" /> i - VI - v - VII</label>
      <label><input type="checkbox" value="I - V - IV - V - vi" /> I - V - IV - V - vi</label>
      <label><input type="checkbox" value="i - VI - iv - VII" /> i - VI - iv - VII</label>
    </div>
    <div style="margin-top: 15px;">
      <label for="customProg">Custom progression (optional):</label>
      <input type="text" id="customProg" placeholder="e.g. i - iv - ‚ô≠VII - v" />
      <button onclick="addCustomProg()">‚úîÔ∏è</button>
    </div>
  </div>

  <div id="rhythm" class="page section-box" style="display:none;">
    <h2>Rhythm</h2>
    <label>Select Pattern:</label>
    <select id="rhythm">
      <option value="stabs">Staccato Stabs</option>
      <option value="drone">Droning Strums</option>
      <option value="16ths">16th Note Machine</option>
      <option value="jerky">Jerky Offbeat</option>
    </select>
  </div>

  <div id="preview" class="page section-box" style="display:none;">
    <h2>Preview</h2>
    <p id="generationResult">Hit generate to see your random chord progression!</p>
    <button onclick="generate()">Generate</button>
  </div>

  <script>
    const majorScale = ["I", "ii", "iii", "IV", "V", "vi", "vii¬∞"];
    const minorScale = ["i", "ii¬∞", "III", "iv", "v", "VI", "VII"];

    const allKeys = {
      "C": ["C", "D", "E", "F", "G", "A", "B"],
      "C#": ["C#", "D#", "E#", "F#", "G#", "A#", "B#"],
      "D": ["D", "E", "F#", "G", "A", "B", "C#"],
      "D#": ["D#", "E#", "G", "G#", "A#", "C", "D"],
      "E": ["E", "F#", "G#", "A", "B", "C#", "D#"],
      "F": ["F", "G", "A", "A#", "C", "D", "E"],
      "F#": ["F#", "G#", "A#", "B", "C#", "D#", "E#"],
      "G": ["G", "A", "B", "C", "D", "E", "F#"],
      "G#": ["G#", "A#", "C", "C#", "D#", "F", "G"],
      "A": ["A", "B", "C#", "D", "E", "F#", "G#"],
      "A#": ["A#", "C", "D", "D#", "F", "G", "A"],
      "B": ["B", "C#", "D#", "E", "F#", "G#", "A#"]
    };

    function showPage(id) {
      document.querySelectorAll(".page").forEach(p => p.style.display = "none");
      document.getElementById(id).style.display = "block";
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark-mode");
    }

    function toggleCheckboxes(state) {
      document.querySelectorAll('#chordList input[type="checkbox"]').forEach(cb => cb.checked = state);
    }

    function addCustomProg() {
      const input = document.getElementById('customProg');
      const val = input.value.trim();
      if (!/^([IViv‚ô≠#]+)(\s*-\s*([IViv‚ô≠#]+))*$/.test(val)) {
        alert("Use valid roman numerals only.");
        return;
      }
      const label = document.createElement("label");
      label.classList.add("custom-prog-entry");
      const cb = document.createElement("input");
      cb.type = "checkbox";
      cb.checked = true;
      cb.value = val;
      const txt = document.createTextNode(" " + val);
      const x = document.createElement("button");
      x.textContent = "‚úñ";
      x.onclick = () => label.remove();
      label.append(cb, txt, x);
      document.getElementById("chordList").appendChild(label);
      input.value = '';
    }

    function generate() {
      const key = document.getElementById("key").value;
      const mode = document.getElementById("mode").value;
      const pool = Array.from(document.querySelectorAll('#chordList input:checked')).map(cb => cb.value);
      if (pool.length === 0) {
        alert("Please select at least one chord progression.");
        return;
      }
      const progression = pool[Math.floor(Math.random() * pool.length)];
      const scale = mode === "major" ? majorScale : minorScale;
      const notes = allKeys[key];
      const map = {};
      scale.forEach((roman, i) => map[roman.replace("¬∞", "")] = notes[i]);

      const translated = progression.split("-").map(ch => {
        const clean = ch.trim();
        return map[clean] || clean;
      }).join(" - ");

      document.getElementById("generationResult").textContent = `${progression} ‚Üí ${translated}`;
    }
  </script>
</body>
</html>
